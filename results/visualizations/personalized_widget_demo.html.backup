<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ªæ€§åŒ–æ¨èæŒ‚ä»¶ - åŸºäºèšç±»åˆ†æçš„æ™ºèƒ½æ¨é€</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            padding: 20px;
        }

        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }

        /* å³ä¸‹è§’æŒ‚ä»¶æ ·å¼ */
        .widget-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 320px;
            z-index: 1000;
            animation: slideInUp 0.5s ease-out;
        }

        @keyframes slideInUp {
            from {
                transform: translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .widget {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            color: white;
            position: relative;
            overflow: hidden;
        }

        .widget::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .widget-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
        }

        .widget-close:hover {
            background: rgba(255,255,255,0.3);
        }

        .widget-content {
            position: relative;
            z-index: 1;
        }

        .widget-image {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0.1) 100%);
            border-radius: 12px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }

        .widget-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .widget-image-placeholder {
            color: rgba(255,255,255,0.8);
            font-size: 14px;
            text-align: center;
            padding: 20px;
        }

        .widget-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .widget-subtitle {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 12px;
        }

        .widget-reason {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .widget-cta {
            background: white;
            color: #667eea;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .widget-cta:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .widget-cta:active {
            transform: translateY(0);
        }

        /* èšç±»é€‰æ‹©å™¨ */
        .cluster-selector {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .cluster-selector label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #333;
        }

        .cluster-selector select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .cluster-info {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border-left: 4px solid #667eea;
        }

        .cluster-info h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .cluster-info p {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .cluster-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .widget-container {
                width: calc(100% - 40px);
                right: 20px;
                left: 20px;
            }
        }

        /* éšè—çŠ¶æ€ */
        .widget-container.hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <h1>ğŸ¯ ä¸ªæ€§åŒ–æ¨èæŒ‚ä»¶æ¼”ç¤º</h1>
        <p class="subtitle">åŸºäºèšç±»åˆ†æçš„æ™ºèƒ½æ¨é€ç³»ç»Ÿ - å³ä¸‹è§’æŒ‚ä»¶å±•ç¤º</p>

        <div class="cluster-selector">
            <label for="clusterSelect">é€‰æ‹©èšç±»æŸ¥çœ‹ä¸ªæ€§åŒ–æŒ‚ä»¶ï¼š</label>
            <select id="clusterSelect">
                <option value="">è¯·é€‰æ‹©èšç±»...</option>
            </select>

            <div id="clusterInfo" class="cluster-info" style="display: none;">
                <h3 id="clusterTitle"></h3>
                <p id="clusterDescription"></p>
                <div class="cluster-tags" id="clusterTags"></div>
            </div>
        </div>

        <div style="padding: 20px; background: #f8f9fa; border-radius: 8px;">
            <h3 style="margin-bottom: 15px;">ğŸ“‹ åŠŸèƒ½è¯´æ˜</h3>
            <ul style="line-height: 2; color: #666;">
                <li><strong>æ™ºèƒ½è¯†åˆ«ï¼š</strong>é€šè¿‡æ„å›¾è¯†åˆ«æŠ€æœ¯åˆ†æç”¨æˆ·è¡Œä¸ºï¼Œè‡ªåŠ¨åŒ¹é…æœ€é€‚åˆçš„èšç±»</li>
                <li><strong>ä¸ªæ€§åŒ–å†…å®¹ï¼š</strong>æ ¹æ®èšç±»ç‰¹å¾ç”ŸæˆAIå›¾ç‰‡å’Œå¼•å¯¼æ€§æ–‡æœ¬</li>
                <li><strong>ç²¾å‡†æ¨é€ï¼š</strong>åœ¨ç”¨æˆ·æµè§ˆè¿‡ç¨‹ä¸­ï¼Œå³ä¸‹è§’å¼¹å‡ºä¸ªæ€§åŒ–æ¨èæŒ‚ä»¶</li>
                <li><strong>ä¿ƒè¿›è½¬åŒ–ï¼š</strong>é€šè¿‡é’ˆå¯¹æ€§çš„å†…å®¹å¼•å¯¼ç”¨æˆ·ä¸‹å•</li>
            </ul>
        </div>
    </div>

    <!-- å³ä¸‹è§’æŒ‚ä»¶ -->
    <div id="widgetContainer" class="widget-container hidden">
        <div class="widget">
            <button class="widget-close" onclick="closeWidget()">Ã—</button>
            <div class="widget-content">
                <div class="widget-image" id="widgetImage">
                    <div class="widget-image-placeholder">
                        ğŸ¤ AIç”Ÿæˆçš„äº§å“å›¾ç‰‡<br>
                        <small>åŸºäºèšç±»ç‰¹å¾ç”Ÿæˆ</small>
                    </div>
                </div>
                <div class="widget-title" id="widgetTitle">ä¸ªæ€§åŒ–æ¨è</div>
                <div class="widget-subtitle" id="widgetSubtitle">ä¸“ä¸ºæ‚¨å®šåˆ¶</div>
                <div class="widget-reason" id="widgetReason">åŸºäºæ‚¨çš„æµè§ˆè¡Œä¸ºï¼Œæˆ‘ä»¬ä¸ºæ‚¨æ¨èæœ€é€‚åˆçš„äº§å“</div>
                <button class="widget-cta" id="widgetCTA" onclick="handleCTAClick()">ç«‹å³æŸ¥çœ‹ â†’</button>
            </div>
        </div>
    </div>

    <script id="widgetsData" type="application/json"></script>
    <script>
        let widgetsData = [];
        let currentWidget = null;

        // åŠ è½½æŒ‚ä»¶é…ç½®
        async function loadWidgets() {
            try {
                const response = await fetch('personalized_widgets_config.json');
                widgetsData = await response.json();
                populateClusterSelector();
            } catch (error) {
                console.error('åŠ è½½æŒ‚ä»¶é…ç½®å¤±è´¥:', error);
                // ä½¿ç”¨ç¤ºä¾‹æ•°æ®
                widgetsData = getExampleWidgets();
                populateClusterSelector();
            }
        }

        // ç¤ºä¾‹æ•°æ®ï¼ˆå¦‚æœæ— æ³•åŠ è½½JSONï¼‰
        function getExampleWidgets() {
            return [
                {
                    cluster_id: 'cluster_0',
                    time_range: '10-30s',
                    size: 116,
                    differentiation_score: 2.0,
                    unique_interests: ['Portable Speakers'],
                    unique_attributes: ['Wireless Microphones', 'Sound Quality', 'Portable Design'],
                    widget: {
                        image_prompt: 'Modern, elegant portable karaoke speaker with wireless microphones, professional product photography',
                        title: 'ä¸“ä¸ºä¾¿æºéŸ³å“çˆ±å¥½è€…è®¾è®¡',
                        subtitle: 'çªå‡ºæ— çº¿éº¦å…‹é£ç‰¹æ€§',
                        recommendation_reason: 'åŸºäºæ‚¨çš„å…´è¶£åå¥½ï¼Œæˆ‘ä»¬ä¸ºæ‚¨æ¨èPortable Speakersç›¸å…³äº§å“',
                        cta_text: 'ç«‹å³æŸ¥çœ‹ â†’',
                        personalization_level: 'high'
                    }
                }
            ];
        }

        // å¡«å……èšç±»é€‰æ‹©å™¨
        function populateClusterSelector() {
            const select = document.getElementById('clusterSelect');
            widgetsData.forEach((widget, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `${widget.cluster_id} (${widget.size}ä½ç”¨æˆ·, ${widget.time_range}, å·®å¼‚åŒ–: ${widget.differentiation_score})`;
                select.appendChild(option);
            });
        }

        // æ˜¾ç¤ºèšç±»ä¿¡æ¯
        function showClusterInfo(index) {
            const widget = widgetsData[index];
            if (!widget) return;

            const infoDiv = document.getElementById('clusterInfo');
            const title = document.getElementById('clusterTitle');
            const description = document.getElementById('clusterDescription');
            const tags = document.getElementById('clusterTags');

            title.textContent = `${widget.cluster_id} - ${widget.size}ä½ç”¨æˆ·`;
            description.textContent = `æ—¶é—´èŒƒå›´: ${widget.time_range} | å·®å¼‚åŒ–åˆ†æ•°: ${widget.differentiation_score}`;

            tags.innerHTML = '';
            widget.unique_interests.forEach(interest => {
                const tag = document.createElement('span');
                tag.className = 'tag';
                tag.textContent = `å…´è¶£: ${interest}`;
                tags.appendChild(tag);
            });
            widget.unique_attributes.forEach(attr => {
                const tag = document.createElement('span');
                tag.className = 'tag';
                tag.textContent = `å±æ€§: ${attr}`;
                tags.appendChild(tag);
            });

            infoDiv.style.display = 'block';
        }

        // æ˜¾ç¤ºæŒ‚ä»¶
        function showWidget(index) {
            const widget = widgetsData[index];
            if (!widget) return;

            currentWidget = widget;
            const widgetData = widget.widget;
            const container = document.getElementById('widgetContainer');

            // æ›´æ–°æŒ‚ä»¶å†…å®¹
            document.getElementById('widgetTitle').textContent = widgetData.title;
            document.getElementById('widgetSubtitle').textContent = widgetData.subtitle;
            document.getElementById('widgetReason').textContent = widgetData.recommendation_reason;
            document.getElementById('widgetCTA').textContent = widgetData.cta_text;

            // ç”ŸæˆAIå›¾ç‰‡ï¼ˆè¿™é‡Œä½¿ç”¨å ä½ç¬¦ï¼Œå®é™…åº”è¯¥è°ƒç”¨AIå›¾ç‰‡ç”ŸæˆAPIï¼‰
            const imageDiv = document.getElementById('widgetImage');
            imageDiv.innerHTML = `
                <div class="widget-image-placeholder">
                    ğŸ¤ ${widgetData.image_prompt}<br>
                    <small style="font-size: 11px; opacity: 0.7;">AIç”Ÿæˆçš„äº§å“å›¾ç‰‡é¢„è§ˆ</small>
                </div>
            `;

            // æ˜¾ç¤ºæŒ‚ä»¶
            container.classList.remove('hidden');

            // 3ç§’åè‡ªåŠ¨å…³é—­ï¼ˆå¯é€‰ï¼‰
            // setTimeout(() => closeWidget(), 10000);
        }

        // å…³é—­æŒ‚ä»¶
        function closeWidget() {
            const container = document.getElementById('widgetContainer');
            container.classList.add('hidden');
        }

        // å¤„ç†CTAç‚¹å‡»
        function handleCTAClick() {
            if (currentWidget) {
                // è¿™é‡Œåº”è¯¥è·³è½¬åˆ°å¯¹åº”çš„äº§å“é¡µé¢æˆ–æ‰§è¡Œç›¸åº”çš„æ“ä½œ
                alert(`è·³è½¬åˆ° ${currentWidget.cluster_id} çš„æ¨èäº§å“é¡µé¢\n\nå®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šï¼š\n1. è·³è½¬åˆ°åŒ¹é…çš„äº§å“é¡µé¢\n2. é«˜äº®æ˜¾ç¤ºç›¸å…³äº§å“\n3. å±•ç¤ºä¸ªæ€§åŒ–æ¨èå†…å®¹`);
                closeWidget();
            }
        }

        // èšç±»é€‰æ‹©å™¨å˜åŒ–äº‹ä»¶
        document.getElementById('clusterSelect').addEventListener('change', function(e) {
            const index = parseInt(e.target.value);
            if (!isNaN(index) && index >= 0) {
                showClusterInfo(index);
                showWidget(index);
            } else {
                document.getElementById('clusterInfo').style.display = 'none';
                closeWidget();
            }
        });

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', function() {
            loadWidgets();
        });

        // æ¨¡æ‹Ÿæ„å›¾è¯†åˆ«å’Œè‡ªåŠ¨æ¨é€ï¼ˆæ¼”ç¤ºç”¨ï¼‰
        function simulateIntentRecognition() {
            // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šï¼š
            // 1. åˆ†æç”¨æˆ·çš„æµè§ˆè¡Œä¸º
            // 2. æå–æ„å›¾ç‰¹å¾
            // 3. åŒ¹é…åˆ°å¯¹åº”çš„èšç±»
            // 4. è‡ªåŠ¨æ˜¾ç¤ºä¸ªæ€§åŒ–æŒ‚ä»¶

            console.log('æ¨¡æ‹Ÿæ„å›¾è¯†åˆ«...');
            // éšæœºé€‰æ‹©ä¸€ä¸ªèšç±»è¿›è¡Œæ¼”ç¤º
            if (widgetsData.length > 0) {
                const randomIndex = Math.floor(Math.random() * widgetsData.length);
                setTimeout(() => {
                    document.getElementById('clusterSelect').value = randomIndex;
                    showClusterInfo(randomIndex);
                    showWidget(randomIndex);
                }, 2000);
            }
        }

        // 5ç§’åè‡ªåŠ¨æ¼”ç¤ºï¼ˆå¯é€‰ï¼‰
        // setTimeout(simulateIntentRecognition, 5000);
    </script>
</body>
</html>

